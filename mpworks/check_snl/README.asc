http://the-huck.com[Patrick Huck] (https://github.com/tschaume[tschaume]), Oct-15-2014 +
*Under Development*

:toc:
:toc-placement: manual

[options="compact"]
toc::[]

SNL & SNL Group Checks for next-gen MP-ID
-----------------------------------------

Report
~~~~~~

ICSD / SNL parse failures
^^^^^^^^^^^^^^^^^^^^^^^^^

In 2012, MP imported a set of structures that MIT parsed from the ICSD
database. The issue was that a subset of the MIT structures contained sites with zero
occupancy which were propagated into the MP SNL database. The zero-occupancy sites caused
the structures to be incorrectly flagged as not ordered and hence the according
calculations were actually never run. Within the scope of preparing
`snlgroup_id(_final)` as next-gen mp-id, these parser failures need to be fixed
and structures resubmitted if zero-occupancy sites indeed affect the duplicate
checking (structure matching) and/or the space group assignment. We verified
the latter by taking an example zero-occupancy structure from the SNL database,
removing all the zero-occupancy sites from a copy of the structure and
comparing the two against each other. This procedure caused the duplicate
finder to fail right away. As for the spacegroup checker, it initially was not
affected by the presence or removal of zero-occupancy sites at symmetry space
points but could easily be coaxed into failure by adding a zero-occupancy site
at an off-symmetry space point. This should not happen since the structures
stay identical under addition or removal of zero-occupancy sites. Hence, all
structures with such zero-occupancy sites need: i) zero-occupancy sites
removed, ii) is_ordered re-evaluated, iii) spacegroup re-evaluated, and iv)
snlgroup re-evaluated. The MP's SNL database has been
link:occu_sites_query.py[queried] for all occurences of such zero-occupancy
structures link:results/zero_occu_sites.csv[resulting] in 127 affected SNLs out
of 411670 in total. The 38 SNLs that are missing the `icsd_id` have the
`is_valid` flag set to `False` and/or contain too many sites (>200?) to
actually be calculated anyway. Since there exists an updated ICSD database with
zero-occupancy sites removed already propagated into the `icsd_crystals_mit`
database, the above SNL entries can be corrected by simply deprecating them and
(re-)adding new SNLs via the `icsd_to_snl` converter. The affected
`snlgroup_ids` are then resubmitted for calculation. The new utility function
link:../snl_utils/utils.py[deprecate_snl()] deprecates an existing SNL by
adding 'DEPRECATED' to its `about.remarks` as well as to the SNLGroup's
`canonical_snl.about.remarks` if the SNL happens to be the canonical SNL of the
respective SNL group. For now, deprecated canoncial SNLs have not been replaced
with another non-deprecated member of the SNL group if existent.

Analysis Overview
~~~~~~~~~~~~~~~~~

Monitoring and Analysis via https://plot.ly[Plotly's] REST/Streaming API:
link:check_snl.py[check_snl.py] or link:builders.py[builders.py]

|===========================================================
| *Results:* +
link:results/bad_snls.csv[bad SNLs] from 'spacegroups' check +
link:results/bad_snlgroups.csv[bad SNL Groups] from 'groupmembers' check +
link:results/bad_snlgroups_2.csv[bad SNL Groups] from 'canonicals' check +
link:results/zero_occu_sites.csv[SNLs w/ zero-occupancy sites] .2+| *Video:* (click to view) +
image:http://share.gifyoutube.com/YO8W8G.gif["SNLs & SNL Groups Check",link="http://youtu.be/QjQXpgxSx7o"]
| *History:* +
'2014-09-25': http://youtu.be/QFPX5pvruMA[video], link:$$https://plot.ly/~tschaume/3$$[interactive plot] +
'2014-09-27': http://youtu.be/QjQXpgxSx7o[video], link:$$https://plot.ly/~tschaume/6$$[interactive plot] +
'2014-10-07': link:$$https://plot.ly/~tschaume/8$$[interactive plot]
2+| *Interactive Plot:* (click to view) +
image:https://www.evernote.com/shard/s192/sh/01d02d38-039b-4434-977e-3ffd0af72af3/d2452eb560ddd736b77f2fbc83a6e2c4/deep/0/SNL-Group-Checks-Stream.png["SNLs & SNL Groups Check", link="https://plot.ly/~tschaume/6"]
|===========================================================

// vim: set syntax=asciidoc:
